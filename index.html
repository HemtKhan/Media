<!DOCTYPE html>
<html lang="dr" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KHAN | Luxury Glow Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body { background-color: #020202; color: #ffffff; font-family: 'Plus Jakarta Sans', sans-serif; text-align: right; overflow-x: hidden; }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 30px; }
        
        /* Glow Buttons matching Brand Colors */
        .glow-btn { 
            width: 55px; height: 42px; border-radius: 14px; display: flex; align-items: center; 
            justify-content: center; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); 
            background: rgba(255,255,255,0.02); font-size: 1.1rem;
        }
        .glow-btn:hover { transform: translateY(-3px); }
        .glow-btn.active { border-color: var(--c); box-shadow: 0 0 20px var(--c); background: var(--bg); }
        .glow-btn i, .glow-btn span { color: #fff; transition: 0.3s; }
        .glow-btn.active i, .glow-btn.active span { color: var(--c); filter: drop-shadow(0 0 5px var(--c)); }

        select, input { background: #080808 !important; border: 1px solid rgba(255,255,255,0.1) !important; color: #fff !important; border-radius: 16px !important; padding: 14px !important; outline: none; width: 100%; }
        .order-btn { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); box-shadow: 0 10px 25px -5px rgba(37, 99, 235, 0.4); border-radius: 20px; }
    </style>
</head>
<body class="pb-24">

    <header class="p-6 flex justify-center items-center sticky top-0 z-50 glass-card border-none rounded-none mb-8">
        <div class="flex items-center gap-3">
            <div class="bg-blue-600 p-2 rounded-xl shadow-lg shadow-blue-900/40">
                <i class="fas fa-crown text-white text-xs"></i>
            </div>
            <span class="text-3xl font-black tracking-tighter italic uppercase text-white">KHAN</span>
        </div>
    </header>

    <main class="px-6 max-w-md mx-auto">
        <div class="grid grid-cols-5 gap-3 mb-10" id="platformGrid">
            <div class="glow-btn active" data-id="instagram" style="--c:#e1306c; --bg:rgba(225,48,108,0.1)"><i class="fab fa-instagram"></i></div>
            <div class="glow-btn" data-id="tiktok" style="--c:#00f2ea; --bg:rgba(0,242,234,0.1)"><i class="fab fa-tiktok"></i></div>
            <div class="glow-btn" data-id="youtube" style="--c:#ff0000; --bg:rgba(255,0,0,0.1)"><i class="fab fa-youtube"></i></div>
            <div class="glow-btn" data-id="x" style="--c:#ffffff; --bg:rgba(255,255,255,0.1)"><span class="font-bold">ğ•</span></div>
            <div class="glow-btn" data-id="spotify" style="--c:#1DB954; --bg:rgba(29,185,84,0.1)"><i class="fab fa-spotify"></i></div>
            <div class="glow-btn" data-id="telegram" style="--c:#0088cc; --bg:rgba(0,136,204,0.1)"><i class="fab fa-telegram"></i></div>
            <div class="glow-btn" data-id="facebook" style="--c:#1877F2; --bg:rgba(24,119,242,0.1)"><i class="fab fa-facebook"></i></div>
            <div class="glow-btn" data-id="discord" style="--c:#5865F2; --bg:rgba(88,101,242,0.1)"><i class="fab fa-discord"></i></div>
            <div class="glow-btn" data-id="reddit" style="--c:#FF4500; --bg:rgba(255,69,0,0.1)"><i class="fab fa-reddit"></i></div>
            <div class="glow-btn" data-id="snapchat" style="--c:#FFFC00; --bg:rgba(255,252,0,0.1)"><i class="fab fa-snapchat"></i></div>
            <div class="glow-btn" data-id="linkedin" style="--c:#0077b5; --bg:rgba(0,119,181,0.1)"><i class="fab fa-linkedin"></i></div>
            <div class="glow-btn" data-id="whatsapp" style="--c:#25D366; --bg:rgba(37,211,102,0.1)"><i class="fab fa-whatsapp"></i></div>
            <div class="glow-btn" data-id="threads" style="--c:#ffffff; --bg:rgba(255,255,255,0.1)"><i class="fab fa-threads"></i></div>
            <div class="glow-btn" data-id="kick" style="--c:#53fc18; --bg:rgba(83,252,24,0.1)"><span class="font-bold text-sm">K</span></div>
            <div class="glow-btn" data-id="soundcloud" style="--c:#ff3300; --bg:rgba(255,51,0,0.1)"><i class="fab fa-soundcloud"></i></div>
            <div class="glow-btn" data-id="twitch" style="--c:#9146FF; --bg:rgba(145,70,255,0.1)"><i class="fab fa-twitch"></i></div>
            <div class="glow-btn" data-id="bluesky" style="--c:#0085ff; --bg:rgba(0,133,255,0.1)"><i class="fas fa-cloud"></i></div>
        </div>

        <div id="orderBox" class="glass-card p-8 shadow-2xl">
            <div class="flex items-center gap-3 mb-8 flex-row-reverse">
                <div class="w-1.5 h-6 bg-blue-600 rounded-full"></div>
                <h3 id="platformTitle" class="font-extrabold text-xl uppercase tracking-tighter text-white">INSTAGRAM</h3>
            </div>

            <div class="space-y-6">
                <div>
                    <label class="text-[10px] uppercase font-bold text-gray-500 mb-2 block mr-1">Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±ÙˆÛŒØ³ (Ø¨Ø§ Û±ÛµÙª Ø³ÙˆØ¯)</label>
                    <select id="serviceSelect" class="text-sm" onchange="updateDetails()"></select>
                </div>
                <div>
                    <label class="text-[10px] uppercase font-bold text-gray-500 mb-2 block mr-1">Ù„ÛŒÙ†Ú© (Link)</label>
                    <input type="text" id="orderLink" placeholder="Ù„ÛŒÙ†Ú© Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." class="text-sm">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] uppercase font-bold text-gray-500 mb-2 block mr-1">ØªØ¹Ø¯Ø§Ø¯ (Quantity)</label>
                        <input type="number" id="qty" value="1000" class="text-sm" oninput="calculate()">
                    </div>
                    <div>
                        <label class="text-[10px] uppercase font-bold text-gray-500 mb-2 block mr-1">Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù„ ($)</label>
                        <div class="p-3.5 rounded-2xl bg-blue-600/10 border border-blue-500/20 text-blue-400 font-bold text-center text-xl">
                            $<span id="total">0.00</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white/5 p-4 rounded-xl text-[11px] text-gray-400">
                    Ø­Ø¯Ø§Ù‚Ù„ Ø³ÙØ§Ø±Ø´: <span id="minQty" class="text-white">--</span> | Ø­Ø¯Ø§Ú©Ø«Ø±: <span id="maxQty" class="text-white">--</span>
                </div>
                <button onclick="sendWA()" class="order-btn w-full py-5 font-extrabold text-white flex items-center justify-center gap-3 active:scale-95 transition-all">
                    <i class="fab fa-whatsapp text-xl"></i>
                    Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´ Ø¨Ù‡ ÙˆØ§ØªØ³Ø§Ù¾
                </button>
            </div>
        </div>
    </main>

    <script>
        const PROFIT_MARGIN = 1.15; // 15% Profit Margin

        // âœ… DB stays same shape, BUT it will be filled from services.json automatically
        const db = {
            instagram: [],
            tiktok: [],
            youtube: [],
            x: [],
            spotify: [],
            telegram: [],
            facebook: [],
            discord: [],
            reddit: [],
            snapchat: [],
            linkedin: [],
            whatsapp: [],
            threads: [],
            kick: [],
            soundcloud: [],
            twitch: [],
            bluesky: []
        };

        // ---- Helpers (no design change) ----
        function cleanText(str) {
            if (!str) return "";
            // decode HTML entities like &#039;
            const t = document.createElement("textarea");
            t.innerHTML = String(str);
            let s = t.value;

            // try fix mojibake like "Ã°Å¸"
            try { if (s.includes("Ã°Å¸")) s = decodeURIComponent(escape(s)); } catch (e) {}
            return s;
        }

        function detectPlatform(item) {
            const txt = (cleanText(item.category || "") + " " + cleanText(item.name || "")).toLowerCase();

            if (txt.includes("instagram")) return "instagram";
            if (txt.includes("tiktok") || txt.includes("tik tok")) return "tiktok";
            if (txt.includes("youtube") || txt.includes("yt ")) return "youtube";
            if (txt.includes("telegram")) return "telegram";
            if (txt.includes("facebook") || txt.includes("fb")) return "facebook";
            if (txt.includes("spotify")) return "spotify";
            if (txt.includes("snapchat")) return "snapchat";
            if (txt.includes("discord")) return "discord";
            if (txt.includes("reddit")) return "reddit";
            if (txt.includes("linkedin")) return "linkedin";
            if (txt.includes("whatsapp")) return "whatsapp";
            if (txt.includes("threads")) return "threads";
            if (txt.includes("kick")) return "kick";
            if (txt.includes("soundcloud")) return "soundcloud";
            if (txt.includes("twitch")) return "twitch";
            if (txt.includes("bluesky") || txt.includes("blue sky")) return "bluesky";

            // X/Twitter detection
            if (txt.includes("twitter") || txt.includes(" x ") || txt.startsWith("x ")) return "x";

            // default: ignore (not shown) unless you add button later
            return null;
        }

        // ---- Your existing functions (same UI logic) ----
        function populate(id) {
            const list = (db[id] && db[id].length)
                ? db[id]
                : [{ n: "Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...", r: 0, min: 0, max: 0, sid: "-" }];

            const select = document.getElementById('serviceSelect');
            document.getElementById('platformTitle').innerText = id.toUpperCase();

            // (optional) sort by cheapest first
            list.sort((a,b) => Number(a.r) - Number(b.r));

            select.innerHTML = list.map(s => {
                const finalRate = (parseFloat(s.r) * PROFIT_MARGIN).toFixed(2);
                return `<option value="${finalRate}" data-min="${s.min}" data-max="${s.max}" data-sid="${s.sid}">
                    ${s.n} â€” $${finalRate}
                </option>`;
            }).join('');

            updateDetails();
        }

        function updateDetails() {
            const opt = document.getElementById('serviceSelect').selectedOptions[0];
            document.getElementById('minQty').innerText = opt?.dataset?.min ?? "--";
            document.getElementById('maxQty').innerText = opt?.dataset?.max ?? "--";
            calculate();
        }

        function calculate() {
            const rate = parseFloat(document.getElementById('serviceSelect').value) || 0;
            const qty = parseInt(document.getElementById('qty').value) || 0;
            const total = (qty / 1000) * rate;
            document.getElementById('total').innerText = total.toFixed(3);
        }

        function sendWA() {
            const opt = document.getElementById('serviceSelect').selectedOptions[0];
            const service = opt ? opt.text : "-";
            const sid = opt?.dataset?.sid ?? "-";

            const link = document.getElementById('orderLink').value.trim();
            const qty = document.getElementById('qty').value;
            const total = document.getElementById('total').innerText;

            if(!link) return alert("Ù„Ø·ÙØ§Ù‹ Ù„ÛŒÙ†Ú© Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!");

            const waMsg = encodeURIComponent(
`âš¡ KHAN PANEL ORDER âš¡

â­ Ø³Ø±ÙˆÛŒØ³: ${service}
ğŸ†” Service ID: ${sid}
ğŸ”— Ù„ÛŒÙ†Ú©: ${link}
ğŸ”¢ ØªØ¹Ø¯Ø§Ø¯: ${qty}
ğŸ’° Ù‚ÛŒÙ…Øª Ú©Ù„: $${total}`
            );

            window.open(`https://wa.me/93728158308?text=${waMsg}`, '_blank');
        }

        document.getElementById('platformGrid').onclick = (e) => {
            const btn = e.target.closest('.glow-btn');
            if (btn) {
                document.querySelectorAll('.glow-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                populate(btn.dataset.id);
            }
        };

        // âœ… NEW: Load ALL services from services.json (no API, no manual copy/paste)
        async function loadServicesFile() {
            try {
                const res = await fetch("./services.json", { cache: "no-store" });
                const list = await res.json();

                if (!Array.isArray(list)) throw new Error("services.json must be an array");

                // Clear db
                Object.keys(db).forEach(k => db[k] = []);

                // Fill db by detecting platform
                for (const item of list) {
                    const p = detectPlatform(item);
                    if (!p || !db[p]) continue;

                    const rate = Number(item.rate);
                    if (!Number.isFinite(rate)) continue;

                    db[p].push({
                        n: cleanText(item.name || "Service"),
                        r: rate,
                        min: item.min ?? 0,
                        max: item.max ?? 0,
                        sid: item.service ?? "-"
                    });
                }

            } catch (err) {
                console.log("Failed to load services.json:", err);
                // If file missing, UI still works, but shows "Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ..."
            }

            populate('instagram'); // start default
        }

        loadServicesFile();
    </script>
</body>
</html>
