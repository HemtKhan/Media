<!DOCTYPE html>
<html lang="dr" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>KHAN | Luxury Glow Panel</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

    * { -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; }

    html { scroll-behavior: smooth; height: 100%; overflow-x: hidden; }

    body {
      background-color: #020202;
      color: #ffffff;
      font-family: 'Plus Jakarta Sans', sans-serif;
      text-align: right;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      height: 100%;
      position: relative;
    }

    /* Prevent iOS zoom on input focus */
    input, select, textarea { font-size: 16px !important; transform: translateZ(0); }
    @supports (-webkit-touch-callout: none) { input, select, textarea { font-size: 16px !important; } }

    /* Hide increment buttons on number inputs */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    input[type="number"] { -moz-appearance: textfield; }

    .glass-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(25px);
      -webkit-backdrop-filter: blur(25px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 30px;
    }

    /* ===== ICON BUTTONS ===== */
    .glow-btn {
      width: 55px;
      height: 42px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(255,255,255,0.12);
      background: var(--bg);
      font-size: 1.15rem;
      position: relative;
      overflow: hidden;
      transform: translateZ(0);
      -webkit-transform: translateZ(0);
    }

    .glow-btn::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 50% 50%,
        color-mix(in srgb, var(--c) 55%, transparent),
        transparent 60%);
      opacity: 0.55;
      filter: blur(10px);
      pointer-events: none;
    }

    .glow-btn:hover {
      transform: translateY(-3px) translateZ(0);
      border-color: rgba(255,255,255,0.18);
      box-shadow: 0 0 14px color-mix(in srgb, var(--c) 45%, transparent);
    }

    .glow-btn:active { transform: scale(0.97) translateZ(0); transition-duration: 0.1s; }

    .glow-btn.active {
      border-color: var(--c);
      background: var(--bg);
      box-shadow:
        0 0 22px color-mix(in srgb, var(--c) 70%, transparent),
        0 0 44px color-mix(in srgb, var(--c) 35%, transparent);
    }

    .glow-btn i, .glow-btn span {
      color: #fff;
      position: relative;
      z-index: 2;
      transition: color 0.2s ease;
    }

    .glow-btn.active i, .glow-btn.active span { color: #000; }

    select, input {
      background: #080808 !important;
      border: 1px solid rgba(255,255,255,0.1) !important;
      color: #fff !important;
      border-radius: 16px !important;
      padding: 14px !important;
      outline: none;
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
      transform: translateZ(0);
    }

    input:focus, select:focus {
      border-color: rgba(37, 99, 235, 0.5) !important;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1) !important;
    }

    .order-btn {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      box-shadow: 0 10px 25px -5px rgba(37,99,235,0.4);
      border-radius: 20px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      transform: translateZ(0);
      -webkit-transform: translateZ(0);
    }

    .order-btn:active { transform: scale(0.98) translateZ(0); transition-duration: 0.1s; }

    /* ===== MODAL SMOOTH ANIMATION ===== */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      opacity: 0;
      transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 998;
    }

    .modal-sheet {
      position: fixed;
      bottom: 0;
      right: 0;
      left: 0;
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(25px);
      -webkit-backdrop-filter: blur(25px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 26px 26px 0 0;
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
      transform: translateY(100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 999;
      max-height: 85vh;
      overflow: hidden;
    }

    .modal-open .modal-backdrop { opacity: 1; }
    .modal-open .modal-sheet { transform: translateY(0); }

    #serviceList {
      max-height: 60vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: rgba(59, 130, 246, 0.5) rgba(255, 255, 255, 0.05);
    }

    body.modal-open { overflow: hidden; position: fixed; width: 100%; }

    .service-picker-btn { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); transform: translateZ(0); }
    .service-picker-btn:active { transform: scale(0.99) translateZ(0); }

    button { user-select: none; -webkit-user-select: none; }
  </style>
</head>

<body class="pb-24">

  <header class="p-6 flex justify-center items-center sticky top-0 z-50 glass-card border-none rounded-none mb-8" style="z-index: 100;">
    <div class="flex items-center gap-3">
      <div class="bg-blue-600 p-2 rounded-xl shadow-lg shadow-blue-900/40">
        <i class="fas fa-crown text-black text-xs"></i>
      </div>
      <span class="text-3xl font-black tracking-tighter italic uppercase">KHAN</span>
    </div>
  </header>

  <main class="px-6 max-w-md mx-auto">

    <div class="grid grid-cols-5 gap-3 mb-10" id="platformGrid">
      <div class="glow-btn active" data-id="instagram" style="--c:#e1306c;--bg:rgba(225,48,108,0.12)"><i class="fab fa-instagram"></i></div>
      <div class="glow-btn" data-id="tiktok" style="--c:#00f2ea;--bg:rgba(0,242,234,0.12)"><i class="fab fa-tiktok"></i></div>
      <div class="glow-btn" data-id="youtube" style="--c:#ff0000;--bg:rgba(255,0,0,0.12)"><i class="fab fa-youtube"></i></div>
      <div class="glow-btn" data-id="x" style="--c:#ffffff;--bg:rgba(255,255,255,0.10)"><span class="font-bold">ğ•</span></div>
      <div class="glow-btn" data-id="spotify" style="--c:#1DB954;--bg:rgba(29,185,84,0.12)"><i class="fab fa-spotify"></i></div>

      <div class="glow-btn" data-id="telegram" style="--c:#0088cc;--bg:rgba(0,136,204,0.12)"><i class="fab fa-telegram"></i></div>
      <div class="glow-btn" data-id="facebook" style="--c:#1877F2;--bg:rgba(24,119,242,0.12)"><i class="fab fa-facebook"></i></div>
      <div class="glow-btn" data-id="discord" style="--c:#5865F2;--bg:rgba(88,101,242,0.12)"><i class="fab fa-discord"></i></div>
      <div class="glow-btn" data-id="reddit" style="--c:#FF4500;--bg:rgba(255,69,0,0.12)"><i class="fab fa-reddit"></i></div>
      <div class="glow-btn" data-id="snapchat" style="--c:#FFFC00;--bg:rgba(255,252,0,0.12)"><i class="fab fa-snapchat"></i></div>

      <div class="glow-btn" data-id="linkedin" style="--c:#0077b5;--bg:rgba(0,119,181,0.12)"><i class="fab fa-linkedin"></i></div>
      <div class="glow-btn" data-id="whatsapp" style="--c:#25D366;--bg:rgba(37,211,102,0.12)"><i class="fab fa-whatsapp"></i></div>
      <div class="glow-btn" data-id="threads" style="--c:#ffffff;--bg:rgba(255,255,255,0.10)"><i class="fab fa-threads"></i></div>
      <div class="glow-btn" data-id="kick" style="--c:#53fc18;--bg:rgba(83,252,24,0.12)"><span class="font-bold text-sm">K</span></div>
      <div class="glow-btn" data-id="soundcloud" style="--c:#ff3300;--bg:rgba(255,51,0,0.12)"><i class="fab fa-soundcloud"></i></div>

      <div class="glow-btn" data-id="twitch" style="--c:#9146FF;--bg:rgba(145,70,255,0.12)"><i class="fab fa-twitch"></i></div>
      <div class="glow-btn" data-id="bluesky" style="--c:#0085ff;--bg:rgba(0,133,255,0.12)"><i class="fas fa-cloud"></i></div>
    </div>

    <div id="orderBox" class="glass-card p-8 shadow-2xl">
      <div class="flex items-center gap-3 mb-8 flex-row-reverse">
        <div class="w-1.5 h-6 bg-blue-600 rounded-full"></div>
        <h3 id="platformTitle" class="font-extrabold text-xl uppercase tracking-tighter text-white">INSTAGRAM</h3>
      </div>

      <div class="space-y-6">
        <div>
          <label class="text-[10px] uppercase font-bold text-gray-500 mb-2 block mr-1">Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±ÙˆÛŒØ³</label>

          <button id="servicePickerBtn" onclick="openServiceModal()"
            class="service-picker-btn w-full text-right bg-[#080808] border border-white/10 rounded-2xl p-4 text-sm flex items-center justify-between">
            <span id="selectedServiceText" class="text-white/90">Ø³Ø±ÙˆÛŒØ³ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</span>
            <i class="fas fa-chevron-down text-white/40 transition-transform duration-200" id="pickerIcon"></i>
          </button>

          <select id="serviceSelect" class="hidden" onchange="updateDetails()"></select>
        </div>

        <div>
          <label class="text-[10px] uppercase font-bold text-gray-500 mb-2 block mr-1">Ù„ÛŒÙ†Ú© (Link)</label>
          <input type="text" id="orderLink" placeholder="Ù„ÛŒÙ†Ú© Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." class="text-sm">
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-[10px] uppercase font-bold text-gray-500 mb-2 block mr-1">ØªØ¹Ø¯Ø§Ø¯ (Quantity)</label>
            <input type="number" id="qty" value="1000" class="text-sm" oninput="calculate()">
          </div>

          <div>
            <label class="text-[10px] uppercase font-bold text-gray-500 mb-2 block mr-1">Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù„</label>
            <div class="p-3.5 rounded-2xl bg-blue-600/10 border border-blue-500/20 text-center">
              <div class="text-blue-400 font-extrabold text-xl">
                $<span id="totalUsd">0.00</span>
              </div>
              <div class="text-[12px] text-gray-400 mt-1">
                Ø‹ <span id="totalAfn">0</span>
                <span class="text-gray-500"> (Ù†Ø±Ø®: <span id="rateAfn">65</span> Ø‹ / $)</span>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white/5 p-4 rounded-xl text-[11px] text-gray-400">
          Ø­Ø¯Ø§Ù‚Ù„ Ø³ÙØ§Ø±Ø´: <span id="minQty" class="text-white">--</span> | Ø­Ø¯Ø§Ú©Ø«Ø±: <span id="maxQty" class="text-white">--</span>
        </div>

        <button onclick="sendWA()"
          class="order-btn w-full py-5 font-extrabold text-white flex items-center justify-center gap-3">
          <i class="fab fa-whatsapp text-xl"></i>
          Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´ Ø¨Ù‡ ÙˆØ§ØªØ³Ø§Ù¾
        </button>
      </div>
    </div>
  </main>

  <!-- âœ… Service Picker Modal -->
  <div id="serviceModal" class="hidden">
    <div class="modal-backdrop" onclick="closeServiceModal()"></div>
    <div class="modal-sheet">
      <div class="flex items-center justify-between mb-6">
        <h4 class="font-extrabold text-lg">Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±ÙˆÛŒØ³</h4>
        <button class="text-white/70 text-xl p-2 -m-2" onclick="closeServiceModal()" aria-label="Ø¨Ø³ØªÙ†">âœ•</button>
      </div>

      <div class="mb-4">
        <div class="relative">
          <input id="serviceSearch" oninput="renderServiceList()" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." class="text-sm pr-10">
          <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-white/30"></i>
        </div>
      </div>

      <div id="serviceList" class="space-y-2"></div>
    </div>
  </div>

  <script>
    const PROFIT_MARGIN = 1.15;
    let USD_TO_AFN = 65;
    let isModalOpen = false;

    const db = {
      instagram: [], tiktok: [], youtube: [], x: [], spotify: [], telegram: [], facebook: [],
      discord: [], reddit: [], snapchat: [], linkedin: [], whatsapp: [], threads: [],
      kick: [], soundcloud: [], twitch: [], bluesky: []
    };

    document.addEventListener('DOMContentLoaded', function() {
      loadRateAfn();
      loadServicesFile();
    });

    function fixEncoding(text) {
      if (!text) return "";
      let s = String(text);

      try { s = decodeURIComponent(escape(s)); } catch (e) {}

      s = s.replace(/[\u{1F300}-\u{1FAFF}]/gu, "");
      s = s.replace(/https?:\/\/\S+/gi, "");
      s = s.replace(/\.netlify\/functions\/\S*/gi, "");
      s = s.replace(/netlify\.app\/\S*/gi, "");
      s = s.replace(/media\d+\.netlify\.app/gi, "");
      s = s.replace(/page\s*\d+\s*of\s*\d+/gi, "");
      s = s.replace(/\b\d{1,2}\/\d{1,2}\/\d{2,4}\b/gi, "");
      s = s.replace(/\b\d{1,2}\s*:\s*\d{2}\s*(am|pm)\b/gi, "");
      s = s.replace(/[^a-zA-Z0-9\s\[\]\(\)\-.,:/]/g, "");
      s = s.replace(/\s+/g, " ").trim();
      return s;
    }

    function detectPlatform(item) {
      const txt = (fixEncoding(item.category || "") + " " + fixEncoding(item.name || "")).toLowerCase();
      if (txt.includes("instagram")) return "instagram";
      if (txt.includes("tiktok") || txt.includes("tik tok")) return "tiktok";
      if (txt.includes("youtube") || txt.includes("yt ")) return "youtube";
      if (txt.includes("telegram")) return "telegram";
      if (txt.includes("facebook") || txt.includes("fb")) return "facebook";
      if (txt.includes("spotify")) return "spotify";
      if (txt.includes("snapchat")) return "snapchat";
      if (txt.includes("discord")) return "discord";
      if (txt.includes("reddit")) return "reddit";
      if (txt.includes("linkedin")) return "linkedin";
      if (txt.includes("whatsapp")) return "whatsapp";
      if (txt.includes("threads")) return "threads";
      if (txt.includes("kick")) return "kick";
      if (txt.includes("soundcloud")) return "soundcloud";
      if (txt.includes("twitch")) return "twitch";
      if (txt.includes("bluesky") || txt.includes("blue sky")) return "bluesky";
      if (txt.includes("twitter") || txt.includes(" x ") || txt.startsWith("x ")) return "x";
      return null;
    }

    function populate(id) {
      const list = (db[id] && db[id].length) ? db[id] : [{ n: "Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...", r: 0, min: 0, max: 0, sid: "-" }];
      document.getElementById('platformTitle').innerText = id.toUpperCase();

      list.sort((a,b) => Number(a.r) - Number(b.r));

      const select = document.getElementById('serviceSelect');
      select.innerHTML = list.map(s => {
        const finalRate = (parseFloat(s.r) * PROFIT_MARGIN).toFixed(2);
        const cleanName = fixEncoding(s.n);
        return `<option value="${finalRate}" data-min="${s.min}" data-max="${s.max}" data-sid="${s.sid}">
          ${cleanName}
        </option>`;
      }).join('');

      const firstOpt = select.options[0];
      if(firstOpt){
        document.getElementById("selectedServiceText").innerText = fixEncoding(firstOpt.text);
      }

      updateDetails();
    }

    function updateDetails() {
      const opt = document.getElementById('serviceSelect').selectedOptions[0];
      document.getElementById('minQty').innerText = opt?.dataset?.min ?? "--";
      document.getElementById('maxQty').innerText = opt?.dataset?.max ?? "--";
      calculate();
    }

    function calculate() {
      const rate = parseFloat(document.getElementById('serviceSelect').value) || 0;
      const qty = parseInt(document.getElementById('qty').value) || 0;

      const totalUsd = (qty / 1000) * rate;
      const totalAfn = Math.round(totalUsd * USD_TO_AFN);

      document.getElementById('totalUsd').innerText = totalUsd.toFixed(3);
      document.getElementById('totalAfn').innerText = totalAfn.toLocaleString('en-US');
      document.getElementById('rateAfn').innerText = USD_TO_AFN.toFixed(1);
    }

    function sendWA() {
      const opt = document.getElementById('serviceSelect').selectedOptions[0];
      const service = opt ? fixEncoding(opt.text) : "-";
      const sid = opt?.dataset?.sid ?? "-";

      const link = document.getElementById('orderLink').value.trim();
      const qty = document.getElementById('qty').value;
      const usd = document.getElementById('totalUsd').innerText;
      const afn = document.getElementById('totalAfn').innerText;

      if (!link) return alert("Ù„Ø·ÙØ§Ù‹ Ù„ÛŒÙ†Ú© Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!");

      const platform = document.getElementById('platformTitle').innerText;

      const waMsg = `
ğŸ“Œ KHAN SMM PANEL â€” NEW ORDER

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”¹ Platform: ${platform}
ğŸ”¹ Service: ${service}
ğŸ”¹ Service ID: ${sid}

ğŸ”— Order Link:
${link}

ğŸ“¦ Quantity:
${Number(qty).toLocaleString("en-US")}

ğŸ’° Pricing:
â€¢ USD: $${usd}
â€¢ AFN: Ø‹ ${afn}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ•’ Please confirm availability & delivery time.

ğŸ’³ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:
Ú©Ø§Ø±Øª/Ø¨Ø§Ù†Ú© â€¢ Ú©Ø±ÛŒÙ¾ØªÙˆ (USDT) â€¢ Ù¾Ø±Ø¯Ø§Ø®Øª Ø­Ø¶ÙˆØ±ÛŒ
`.trim();

      window.open("https://wa.me/93728158308?text=" + encodeURIComponent(waMsg), "_blank");
    }

    function platformIconHTML(platformId){
      const map = {
        instagram: `<i class="fab fa-instagram text-[#e1306c] text-lg"></i>`,
        tiktok: `<i class="fab fa-tiktok text-[#00f2ea] text-lg"></i>`,
        youtube: `<i class="fab fa-youtube text-[#ff0000] text-lg"></i>`,
        x: `<span class="font-bold text-white text-lg">ğ•</span>`,
        spotify: `<i class="fab fa-spotify text-[#1DB954] text-lg"></i>`,
        telegram: `<i class="fab fa-telegram text-[#0088cc] text-lg"></i>`,
        facebook: `<i class="fab fa-facebook text-[#1877F2] text-lg"></i>`,
        discord: `<i class="fab fa-discord text-[#5865F2] text-lg"></i>`,
        reddit: `<i class="fab fa-reddit text-[#FF4500] text-lg"></i>`,
        snapchat: `<i class="fab fa-snapchat text-[#FFFC00] text-lg"></i>`,
        linkedin: `<i class="fab fa-linkedin text-[#0077b5] text-lg"></i>`,
        whatsapp: `<i class="fab fa-whatsapp text-[#25D366] text-lg"></i>`,
        threads: `<i class="fab fa-threads text-white text-lg"></i>`,
        kick: `<span class="font-bold text-[#53fc18] text-lg">K</span>`,
        soundcloud: `<i class="fab fa-soundcloud text-[#ff3300] text-lg"></i>`,
        twitch: `<i class="fab fa-twitch text-[#9146FF] text-lg"></i>`,
        bluesky: `<i class="fas fa-cloud text-[#0085ff] text-lg"></i>`
      };
      return map[platformId] || `<i class="fas fa-bolt text-white/70 text-lg"></i>`;
    }

    function openServiceModal() {
      if (isModalOpen) return;
      isModalOpen = true;

      const modal = document.getElementById("serviceModal");
      const pickerIcon = document.getElementById("pickerIcon");
      pickerIcon.style.transform = 'rotate(180deg)';

      modal.classList.remove("hidden");
      document.body.classList.add("modal-open");
      setTimeout(() => modal.classList.add("modal-open"), 10);

      document.getElementById("serviceSearch").value = "";
      renderServiceList();
      setTimeout(() => document.getElementById("serviceSearch").focus(), 350);
    }

    function closeServiceModal() {
      if (!isModalOpen) return;
      isModalOpen = false;

      const modal = document.getElementById("serviceModal");
      const pickerIcon = document.getElementById("pickerIcon");
      pickerIcon.style.transform = 'rotate(0deg)';

      modal.classList.remove("modal-open");
      setTimeout(() => {
        modal.classList.add("hidden");
        document.body.classList.remove("modal-open");
      }, 300);
    }

    /* âœ… FIXED: NO PRICE + FULL TEXT (WRAP) */
    function renderServiceList() {
      const platform = document.querySelector(".glow-btn.active")?.dataset?.id || "instagram";
      const q = (document.getElementById("serviceSearch").value || "").toLowerCase();

      const list = (db[platform] && db[platform].length) ? db[platform] : [];
      const box = document.getElementById("serviceList");

      const filtered = list
        .map((s, i) => ({...s, __i: i}))
        .filter(s => fixEncoding(s.n).toLowerCase().includes(q));

      box.innerHTML = filtered.map((s) => {
        const showName = fixEncoding(s.n);

        return `
          <button onclick="pickService('${platform}', ${s.__i})"
            class="w-full flex items-center gap-3 p-4 rounded-2xl bg-white/5 hover:bg-white/10 transition-all duration-200 text-right active:scale-[0.99] transform active:translate-y-0.5">
            <div class="w-10 h-10 rounded-full bg-black/30 flex items-center justify-center flex-shrink-0">
              ${platformIconHTML(platform)}
            </div>

            <div class="flex-1 min-w-0">
              <!-- âœ… No truncate: show full (wrap) -->
              <div class="text-white font-semibold text-[13px] leading-5 whitespace-normal break-words">
                ${showName}
              </div>

              <div class="text-[11px] text-white/50 mt-1 flex items-center gap-2">
                <span>Min: ${Number(s.min).toLocaleString()}</span>
                <span>â€¢</span>
                <span>Max: ${Number(s.max).toLocaleString()}</span>
              </div>
            </div>
          </button>
        `;
      }).join("") || `<div class="text-white/60 p-4 text-center">Ú†ÛŒØ²ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯</div>`;
    }

    function pickService(platform, realIndex) {
      const list = db[platform] || [];
      const item = list[realIndex];
      if (!item) return;

      const select = document.getElementById("serviceSelect");
      if (select.options[realIndex]) {
        select.selectedIndex = realIndex;
        select.dispatchEvent(new Event("change"));
      }

      document.getElementById("selectedServiceText").innerText = fixEncoding(item.n);
      closeServiceModal();
    }

    document.getElementById('platformGrid').onclick = (e) => {
      const btn = e.target.closest('.glow-btn');
      if (!btn) return;

      document.querySelectorAll('.glow-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      populate(btn.dataset.id);
    };

    async function loadRateAfn() {
      try {
        const res = await fetch("https://open.er-api.com/v6/latest/USD", { cache: "no-store" });
        const data = await res.json();
        const afn = Number(data?.rates?.AFN);
        if (Number.isFinite(afn) && afn > 0) USD_TO_AFN = afn;
      } catch (e) {}
      calculate();
    }

    async function loadServicesFile() {
      try {
        const res = await fetch("./services.json", { cache: "no-store" });
        const list = await res.json();
        if (!Array.isArray(list)) throw new Error("services.json must be an array");

        Object.keys(db).forEach(k => db[k] = []);

        for (const item of list) {
          const p = detectPlatform(item);
          if (!p || !db[p]) continue;

          const rate = Number(item.rate);
          if (!Number.isFinite(rate)) continue;

          db[p].push({
            n: fixEncoding(item.name || "Service"),
            r: rate,
            min: item.min ?? 0,
            max: item.max ?? 0,
            sid: item.service ?? "-"
          });
        }
      } catch (err) {
        console.log("Failed to load services.json:", err);
      }

      populate('instagram');
    }

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && isModalOpen) closeServiceModal();
    });
  </script>
</body>
</html>